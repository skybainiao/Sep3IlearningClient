@page "/search"
@using LoginExample.Models
@using LoginExample.Data
@using LoginExample.Data.Impl
@inject IUserService _service;

<hr style=" border: 2px solid white" />
<br>

<div id="sousuo">
    <form class="chaxun" style="flex-direction: row; align-items: center; justify-content: center">
        <input style=" background-color: rgba(0,0,0,0.6); color:white; width:400px; height: 30px; border-radius: 10px; text-align: center" type="text" placeholder="SearchFriend" @bind="text" >
        <span><button style="margin-left: 20%; width: 70px; height: 30px;text-align: center; border-radius: 10px" type="button" @onclick="search">Search</button></span>
    </form>
</div>
<br><br>

<tbody>
@foreach (var user in _users)
{
    <tr class="search-tr" style="margin-top: 1%; width: 100%; flex-direction: row; float: left">
        <button type="button" class="button-blue" style="margin-left: 5%; width: 1300px; height: 30px; border-radius: 15px; background-color: #7abaff; font-family: Forte">@user.Username</button>
        <button @onclick="() =>SendRequest(user.Username)" type="button" style="margin-left: 5%; width: 100px; height: 30px; border-radius: 15px; font-family: Forte">Add</button>
    </tr>
}
</tbody>
@code {
    private String text;

    private IList<User> _users = new List<User>();

    private UserData _userData = new UserDataService();


    protected override async Task OnInitializedAsync()
    {
        _users = await _userData.getAllUsers();
    }


    public void search()
    {
        if (text!=null)
        {
            if (_users!=null)
            {
                for (int i = 0; i < _users.Count; i++)
                {
                    if (text.Equals(_users[i].Username))
                    {
                        User user = _users[i];
                        _users = new List<User>();
                        _users.Add(user);
                        Console.WriteLine(user.Username);
                        text = null;
                    }
                }
            }
        }
        else
        {
            getAllUsers();
        }
        
    }


    public async void getAllUsers()
    {
        _users = await _userData.getAllUsers();
    }


    public async void SendRequest(String receiver)
    {
        await _userData.sendRequest(_service.getName(), receiver, "Hello,Im: "+_service.getName());
    }
    

}